<languages />

<b>TRADUCTION EN COURS</B> <BR>[https://code.visualstudio.com/ Visual Studio Code] est un environnement de développement local intégré (IDE) personnalisable de [https://www.microsoft.com Microsoft] qui offre plusieurs extensions.

{{Warning
|title=Importante consommation de ressources
|content=<b>VS Code pose beaucoup de problèmes sur les nœuds de connexion. Autant que possible, <i>utilisez-le localement</i> ou configurez-le comme décrit ci-dessous.</b>
}}

{{Warning
|title=Exécution et débogage de code
|content=<b>Si Visual Studio Code est connecté à un système distant, l'exécution ou le débogage du code peut entraîner des problèmes de performance ou des interruptions de système. Utilisez plutôt l'environnement <tt>code-server</tt> plus sécuritaire qui est plus approprié pour le débogage.</b>
}}

* Utilisez VS Code en mode local et évitez de le connecter aux systèmes. Enregistrez vos modifications dans les fichiers de /project avec Git, puis appliquez-les sur les systèmes pour faire les tests.
* Utilisez nano ou vim pour modifier les fichiers directement sur les systèmes.
* Pour le débogage et les tests rapides, vous pouvez charger le module <tt>code-server</tt>.
* Si aucune de ces solutions n'est possible, vous pouvez configurer VS Code pour les connexions à distance.

__FORCETOC__

=Utiliser VS Code localement=

Les avantages sont les suivants :

* vitesse et stabilité : l'exécution locale de VS Code réduit les interruptions réseau et améliore la performance, ce qui est idéal pour le développement itératif;
* accès direct : vous pouvez interagir avec les fichiers, les extensions et le terminal directement sur votre ordinateur, sans latence;
* possibilité de travailler hors ligne : aucune contrainte de connexion Internet ou de serveur distant, ce qui vous permet de coder n'importe où et n'importe quand.

Il est recommandé de développer localement avec VS Code. Vous pouvez ainsi personnaliser et ajouoter vos extensions et langages préférés avec VS Code.

Une fois votre projet prêt à être testé sur les systèmes, vous pouvez enregistrer vos modifications dans un dépôt Git, les envoyer vers un hébergeur distant comme GitHub ou GitLab, puis vous connecter au système et récupérer vos modifications pour effectuer le test.

Pour plus d'information sur la gestion de versions, voir [https://code.visualstudio.com/docs/sourcecontrol/overview VS Code Source Control].

Après avoir enregistré et envoyé vos modifications vers le dépôt distant, connectez-vous au système via le terminal.
{{Command|ssh <username>@<hostname>.alliancecan.ca}}

Clonez le dépôt (s'il n'existe pas)
{{Command|git clone git@github.com:username/reponame.git}}
ou changez le répertoire pour votre dépôt et incorporez les modifications avec
{{Commands
|cd myrepo
|git pull
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
You can then test your changes in a short (with minimal resources) [[Running_jobs#Interactive_jobs|interactive job]].
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
= File edition on the systems =
While VS Code is great for local development, sometimes you need direct access to files on a remote system. In such cases, terminal-based editors like <tt>nano</tt> or <tt>vim</tt> offer a lightweight and efficient way to edit files directly from the command line.
</div>

Si vous préférez une interface graphique, l'éditeur de texte [[JupyterLab/fr|JupyterLab]] est une option commode; les scripts au formats Markdown, Python et autres sont pris en charge.

<div lang="en" dir="ltr" class="mw-content-ltr">
= Debugging and testing =
If you need to debug or test your code on the systems, you can start a [[JupyterLab#VS_Code|<tt>code-server</tt> instance from Jupyter Lab]].
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
# Access one of the [[JupyterLab#Launching_JupyterLab|options to launch JupyterLab]].
# Select minimal resources and start an interactive JupyterLab job.
# On the Launcher tab, click on the VS Code launcher button.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
{{Note|The <tt>code-server</tt> instance you are accessing is running in a compute job that '''does not''' have internet access.}}
The <tt>code-server</tt> module has several common extensions already available, but we can add more upon request.
</div>

== Installation personnalisée des extensions ==
[en préparation ]

<div lang="en" dir="ltr" class="mw-content-ltr">
= Configuration of VS Code for remote connection =
If none of the above works for your case, one can configure VS Code to connect to a remote host with the Remote SSH extension.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
== SSH configuration ==
If not done already, [[SSH_Keys#Generating_an_SSH_Key|generate your SSH key]] and [[SSH_Keys#Installing_your_key|add your <i>public</i> SSH key on the CCDB]].
</div>

Ensuite, créez ou ajoutez un fichier de configuration SSH sur votre ordinateur local.

{{File
  |name=~/.ssh/config
  |contents=
Host *
  ServerAliveInterval 30
  User your_username

Host rorqual narval nibi fir
  HostName %h.alliancecan.ca
}}

== Configuration locale ==
1. Dans VS Code, ouvrez la palette <i>Command Palette</i> et appuyez <b>Ctrl+Shift+P</b> (Windows/Linux) ou <b>Cmd+Shift+P</b> (macOS).

2. Dans les paramètres d'utilisation, sélectionnez (<b>Preferences: Open User Settings (JSON)</b>) et collez ou intégrez la configuration suivante&nbsp;:
{{File
  |name=local-settings.json
  |contents=
{
  // file-watch + search
  "files.watcherExclude": {
    "**/.git/**": true,
    "**/node_modules/**": true,
    "**/dist/**": true,
    "**/build/**": true,
  },
  "search.exclude": {
    "**/.git/objects/**": true,
    "**/.git/subtree-cache/**": true,
    "**/node_modules/**": true,
  },
  "search.maxThreads": 2,
  "search.ripgrep.maxThreads": 2,
  "search.useIgnoreFiles": true,

  // extensions & updates
  "remote.extensionKind": {
    "*": [
      "ui"
    ],
    "ms-python.python": [
      "ui"
    ]
  },
  "remote.defaultExtensionsIfInstalledLocally": [
    "GitHub.vscode-pull-request-github"
  ],

  // remote-ssh
  "remote.SSH.showLoginTerminal": false,
  "remote.SSH.enableDynamicForwarding": false,
  "remote.SSH.enableServerAutoShutdown": 30,

  "workbench.startupEditor": "none",
}
}}

3. Enregistrez et relancez VS Code.

<div lang="en" dir="ltr" class="mw-content-ltr">
== Remote system configuration ==
1. Log in to the system via an external terminal.
{{Command|ssh <username>@<host>.alliancecan.ca}}
</div>

2. Créez le répertoire.
{{Command|mkdir -p ~/.vscode-server/data/Machine/}}

3. Créez la configuration <tt>settings.json</tt>.
{{Command|nano ~/.vscode-server/data/Machine/settings.json }}

4. Copiez la configuration ci-dessous. Vous pourriez avoir besoin de fusionner manuellement les paramètres avec les vôtres, s'il y a lieu.
{{File
  |name=system-settings.json
  |contents=
{
  // file-watch + search
  "files.watcherExclude": {
    "**/.git/**": true,
    "**/node_modules/**": true,
    "**/dist/**": true,
    "**/build/**": true,
    "/**": true,
  },
  "search.exclude": {
    "**/.git/objects/**": true,
    "**/.git/subtree-cache/**": true,
    "**/node_modules/**": true,
    "/**": true,
  },
  "search.followSymlinks": false,
  "search.maxThreads": 2,
  "search.ripgrep.maxThreads": 2,
  "search.useIgnoreFiles": true,
  "search.searchOnType": false,

  // extensions & updates
  "extensions.autoCheckUpdates": false,
  "extensions.autoUpdate": false,
  "update.mode": "none",
  "remote.extensionKind": {
    "*": [
      "ui"
    ],
    "ms-python.python": [
      "ui"
    ]
  },

  // Copilot
  "chat.agent.enabled": false,
  "github.copilot.enable": {
    "*": false,
  },
  "remote.defaultExtensionsIfInstalledLocally": [
    "GitHub.vscode-pull-request-github"
  ],

  // telemetry & git
  "telemetry.enableTelemetry": false,
  "telemetry.enableCrashReporter": false,
  "telemetry.telemetryLevel": "off",
  "telemetry.feedback.enabled": false,
  "git.autofetch": false,
  "git.enableStatusBarSync": false,

  // remote-ssh
  "remote.SSH.showLoginTerminal": false,
  "remote.SSH.enableDynamicForwarding": false,
  "remote.SSH.enableServerAutoShutdown": 30,

  "workbench.startupEditor": "none",
}
}}

<div lang="en" dir="ltr" class="mw-content-ltr">
== Connecting ==
# Open the Command Palette in VS Code: Press <tt>Ctrl+Shift+P</tt> (Windows/Linux) or <tt>Cmd+Shift+P</tt> (macOS).
# Type <tt>remote</tt> and then select <tt>Connect to Host...</tt>
# Choose the host (remote system) and confirm.
</div>

La connexion se fait avec un nœud de connexion.

{{Warning|title=Sur un nœud de connexion...|content=... ne faites pas de tests, ne faites aucun débogage et n'exécutez pas votre code.}}

<div lang="en" dir="ltr" class="mw-content-ltr">
== Closing your connection ==
# Open the Command Palette in VS Code: Press <tt>Ctrl+Shift+P</tt> (Windows/Linux) or <tt>Cmd+Shift+P</tt> (macOS).
# Type <tt>remote</tt> and then select <tt>Remote-SSH: Kill VS Code Server on Host...</tt>
# Choose the host (remote system) and confirm.
# Open the File menu, and select <tt>Close Remote Connection</tt>.
</div>

== Fonction avancée : Se connecter à un nœud de calcul interactif ==

Mettez à jour votre configuration en ajoutant les lignes suivantes&nbsp;:
<tabs>
<tab name="Narval">
{{File
  |name=~/.ssh/config
  |contents=
Host nc* ng* nl*
  ProxyJump narval
  User your_username
}}
</tab>
<tab name="Rorqual">
{{File|name=~/.ssh/config
  |contents=
Host rc* rg* rl*
  ProxyJump rorqual
  User your_username
}}
</tab>
</tabs>

<div lang="en" dir="ltr" class="mw-content-ltr">
# In an external terminal, connected to the system via an ssh connection, start a new <b>[[Running_jobs#Interactive_jobs|interactive job]]</b> (with <code>salloc</code>) with at least 2000M of memory.
## Note the allocated compute node name.
## If you need to work with <code>SLURM_*</code> environment variables in VS Code, save them all in a ''source'' file: {{Command|env {{!}} grep SLURM_ {{!}} sed -e 's/^\(.*\){{=}}\(.*\)$/export \1{{=}}"\2"/g' > slurm_var.sh}}
# In VS Code, start a new remote session with the name of the allocated compute node.
## Press <code>F1</code> or <code>Ctrl+Shift+P</code> to start the command prompt <code>&gt;</code> in the Command Palette.
## Start typing <i>Remote</i> and select <i>Remote-SSH: Connect to Host... <b>&gt; Remote-SSH: Connect to Host...</i></b>
## Enter the noted compute node name.
### If you get prompted for the type of operating system, select <b>Linux</b>.
# If you need to work with <code>SLURM_*</code> environment variables, navigate to the working directory in a VS Code terminal and ''source'' the <code>slurm_var.sh</code> file. {{Command|source slurm_var.sh}}
</div>

= Remarques importantes = 
* VS Code ne peut pas être utilisé sur les nœuds de connexion de tamIA.