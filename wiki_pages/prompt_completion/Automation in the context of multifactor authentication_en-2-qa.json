[
  {
    "question": "What does the `/cvmfs/soft.computecanada.ca/custom/bin/computecanada/allowed_commands/allowed_commands.sh` script allow?",
    "answer": "This script allows all commands covered by the `transfer_commands.sh`, `archiving_commands.sh`, `file_commands.sh`, `git_commands.sh`, and `slurm_commands.sh` scripts."
  },
  {
    "question": "What three types of constraints must be included in an accepted SSH key for automation nodes?",
    "answer": "Accepted SSH keys must include `restrict`, `from=\"pattern-list\"`, and `command=\"COMMAND\"` constraints."
  },
  {
    "question": "Provide an example of an SSH key accepted for file transfers to an automation node.",
    "answer": "An example key is: `restrict,from=\"216.18.209.*\",command=\"/cvmfs/soft.computecanada.ca/custom/bin/computecanada/allowed_commands/transfer_commands.sh\" ssh-ed25519 AAAAC3NzaC1lZDI1NTE6AACAIExK9iTTDGsyqKKzduA46DvIJ9oFKZ/WN5memqG9Invw`."
  },
  {
    "question": "Provide an example of an SSH key accepted for Slurm commands to an automation node.",
    "answer": "An example key is: `restrict,from=\"216.18.209.*\",command=\"/cvmfs/soft.computecanada.ca/custom/bin/computecanada/allowed_commands/slurm_commands.sh\" ssh-ed25519 AAAAC3NzaC1lZDI1NTE6AACAIExK9iTTDGsyqKKzduA46DvIJ9oFKZ/WN5memqG9Invw`."
  },
  {
    "question": "Where should the SSH key constraints be added before uploading the key?",
    "answer": "The constraints must be added directly as text in front of your key, before uploading the complete string to your account at `https://ccdb.alliancecan.ca/ssh_authorized_keys`."
  },
  {
    "question": "What is the hostname for the Fir cluster's automation node?",
    "answer": "The hostname for the Fir cluster's automation node is `robot.fir.alliancecan.ca`."
  },
  {
    "question": "What is the hostname for the Narval cluster's automation node?",
    "answer": "The hostname for the Narval cluster's automation node is `robot.narval.alliancecan.ca`."
  },
  {
    "question": "What is the hostname for the Nibi cluster's automation node?",
    "answer": "The hostname for the Nibi cluster's automation node is currently 'TBA' (To Be Announced)."
  },
  {
    "question": "What is the hostname for the Rorqual cluster's automation node?",
    "answer": "The hostname for the Rorqual cluster's automation node is `robot.rorqual.alliancecan.ca`."
  },
  {
    "question": "What is the hostname for the Trillium cluster's automation node?",
    "answer": "The hostname for the Trillium cluster's automation node is `robot2.scinet.utoronto.ca`."
  },
  {
    "question": "How do you specify a private key for an `ssh` or `scp` command?",
    "answer": "You use the `-i` parameter, for example: `ssh -i .ssh/private_key_to_use ...` or `scp -i .ssh/private_key_to_use ...`."
  },
  {
    "question": "How do you specify a private key for an `rsync` command?",
    "answer": "You use the `-e` parameter with an `ssh` command, for example: `rsync -e \"ssh -i .ssh/private_key_to_use\" ...`."
  },
  {
    "question": "What is a convenient way to manage SSH key parameters for automation node connections?",
    "answer": "It's often more convenient to put these parameters into your `~/.ssh/config` file, so they get picked up by any ssh client invocation."
  },
  {
    "question": "Provide an example `~/.ssh/config` entry for an automation node.",
    "answer": "An example entry is: `host robot hostname robot.cluster.alliancecan.ca user myrobot identityfile ~/.ssh/my-robot-key identitiesonly yes requesttty no`."
  },
  {
    "question": "What is a potential issue when connecting to an automation node regarding IP addresses?",
    "answer": "The SSH client on your computer may choose to use IPv6 addressing over IPv4, which can cause a mismatch if your key in CCDB uses an IPv4 address mask."
  },
  {
    "question": "What online tool can be used to check your computer's IPv4 and IPv6 addresses?",
    "answer": "You can check your addresses using the web site: `https://test-ipv6.com/`."
  },
  {
    "question": "What is an example of an IPv4 address?",
    "answer": "An IPv4 address could look like `199.241.166.5`."
  },
  {
    "question": "What is an example of an IPv6 address?",
    "answer": "An IPv6 address could look like `2620:123:7002:4::5`."
  },
  {
    "question": "What command can be used to troubleshoot SSH connection problems to an automation node and check the IP version being used?",
    "answer": "The test command `ssh -i ~/.ssh/automation_key -vvv username@robot.rorqual.alliancecan.ca \"ls -l\"` can be used."
  },
  {
    "question": "How can you identify if IPv4 is being used from the debug output of the SSH test command?",
    "answer": "If IPv4 is being used, the 'Connecting to...' message will be similar to `debug1: Connecting to robot.rorqual.alliancecan.ca [199.241.166.5] port 22.`."
  },
  {
    "question": "How can you identify if IPv6 is being used from the debug output of the SSH test command?",
    "answer": "If IPv6 is being used, the 'Connecting to...' message will be similar to `debug1: Connecting to robot.rorqual.alliancecan.ca [2620:123:7002:4::5] port 22.`."
  },
  {
    "question": "What SSH client options can be used to explicitly force IPv4 or IPv6?",
    "answer": "You can use the `-4` option to explicitly use IPv4 or the `-6` option to explicitly use IPv6, to match the format used for the key in CCDB."
  },
  {
    "question": "How can you force SSH to use IPv4 by using an IP address instead of a hostname?",
    "answer": "You can try using an IP address instead of the name, for example, `ssh -i ~/.ssh/automation_key -vvv username@132.219.138.79 \"ls -l\"` for Rorqual."
  },
  {
    "question": "What is a last resort solution for IPv6 connection issues with automation nodes?",
    "answer": "Disabling the IPv6 addressing for your computer is a last resort method, though Microsoft does not recommend it."
  },
  {
    "question": "What Python module is recommended for automating workflows with automation nodes?",
    "answer": "The Paramiko Python module (`https://www.paramiko.org/index.html`) is recommended."
  },
  {
    "question": "How do you load an Ed25519 private key file using Paramiko?",
    "answer": "You load it using `key = paramiko.Ed25519Key.from_private_key_file(\"/home/username/.ssh/cc_allowed\")`."
  },
  {
    "question": "What Paramiko policy allows connecting to hosts not known in the `known_hosts` file?",
    "answer": "Setting `ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())` allows connecting to unknown hosts."
  },
  {
    "question": "How do you establish an SSH connection to an automation node using Paramiko?",
    "answer": "You establish a connection using `ssh.connect(hostname=host, username=user, pkey=key)`."
  },
  {
    "question": "How do you execute a command on a remote automation node with Paramiko?",
    "answer": "You execute a command using `stdin, stdout, stderr = ssh.exec_command(cmd)`."
  },
  {
    "question": "What is the recommended installation command for Paramiko to ensure Ed25519 key type support?",
    "answer": "It is important to install Paramiko with `$ pip install paramiko[all]` to ensure support for the Ed25519 key type."
  }
]