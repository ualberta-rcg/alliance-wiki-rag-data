<languages />

{| class="wikitable"
|-
| Availability: June 19, 2025
|-
| Login node: '''rorqual.alliancecan.ca'''
|-
| Data transfer node (rsync, scp, sftp ...): '''rorqual.alliancecan.ca'''
|-
| [[Automation_in_the_context_of_multifactor_authentication|Automation node]]: robot.rorqual.alliancecan.ca
|-
| Globus collection: '''[https://app.globus.org/file-manager?origin_id=f19f13f5-5553-40e3-ba30-6c151b9d35d4 alliancecan#rorqual]'''
|- 
| JupyterHub: [https://jupyterhub.rorqual.alliancecan.ca/ jupyterhub.rorqual.alliancecan.ca]
|-
| Portal: [https://metrix.rorqual.alliancecan.ca/ metrix.rorqual.alliancecan.ca]
|-
| Webinar: [https://docs.google.com/presentation/d/1Ah61BBKZIJcn_AeosgUspxRCX_amubPUetZY68SfyXU slides], [https://www.youtube.com/watch?v=lXetzrViI8Q video]
|}

Rorqual is a heterogeneous and versatile cluster designed for a wide variety of scientific calculations. Built by Dell Canada and CDW Canada, the cluster is located at the [https://www.etsmtl.ca/en/ École de technologie supérieure] in Montreal. Its name recalls the [https://en.wikipedia.org/wiki/Rorqual rorqual], a marine mammal of which several species can be observed in the St. Lawrence River.

==Access==
Each researcher must [https://ccdb.alliancecan.ca/me/access_systems request access in CCDB], via <i>Resources--> Access Systems</i>.

# Select ''Rorqual'' from the list on the left.
# Select ''I request access''.
# Click on the button to accept each of the following agreements
## Calcul Québec Consent for the collection and use of personal information
## Rorqual Service Level Agreement
## Calcul Québec Terms of Use

It can take <b>up to one hour</b> for your access to be enabled.

<span id="Particularités"></span>
==Site-specific policies==

Rorqual's compute nodes cannot access the internet. If you need an exception to this rule, contact [[Technical_support|technical support]] explaining what you need and why. 

The <code>crontab</code> tool is not offered.

Each job should have a duration of at least one hour (at least five minutes for test jobs) and you cannot have more than 1000 jobs, running or queued, at any given moment. The maximum duration is 7 days (168 hours).

==Storage==
{| class="wikitable sortable"

|-
| HOME <br> Lustre filesystem, 116 TB || 

* This small space cannot be increased; for larger storage needs, use the <code>/project</code> space
* Small per user [[Storage_and_file_management#Filesystem_quotas_and_policies|quotas]]
* Daily automatic backup

|-
| SCRATCH <br> Lustre filesystem, 6.5 PB ||

* Accessible via symbolic link <tt>$HOME/links/scratch</tt>
*Large space for storing temporary files during computations
*No backup system in place 
*Large per user [[Storage_and_file_management#Filesystem_quotas_and_policies|quotas]] 
*Older files are [[Scratch_purging_policy | automatically purged]]

|-
| PROJECT <br> Lustre filesystem, 62 PB ||

* Accessible via symbolic link <tt>$HOME/links/projects/nom-du-projet</tt>
*Designed for sharing data among the members of a research group and for storing large amounts of data 
*Large and adjustable per group [[Storage and file management#Quotas_et_politiques|quotas]] 
*Daily backup
|}

For transferring data via [[Globus/fr|Globus]], use the endpoint specified at the top of this page; for tools like [[Transferring_data#Rsync|rsync]] and [[Transferring_data#SCP|scp]], please use the login node.

==High-performance interconnect==
* InfiniBand interconnect
** HDR 200Gb/s
** Maximum blocking factor 34:6 or 5.667:1
** CPU node island size, up to 31 nodes of 192 cores, fully non-blocking.

<span id="Caractéristiques_des_nœuds"></span>
==Node characteristics==

{| class="wikitable sortable"
! nodes !! cores !! available memory !! storage !! CPU !! GPU
|-
| 670 || rowspan="3"| 192 || rowspan="2"| 750G or 768000M || 1 x SATA SSD, 480G (6Gbit/s) || rowspan="3"| 2 x [https://www.amd.com/en/support/downloads/drivers.html/processors/epyc/epyc-9004-series/amd-epyc-9654.html AMD EPYC 9654 (Zen 4)] @ 2.40 GHz, 384MB cache L3 || rowspan="3"|
|-
| 8 || 1 x NVMe SSD, 3.84TB
|-
| 8 || 3013G or 3086250M || 1 x SATA SSD, 480G (6Gbit/s)
|-
| 81 || 64 || 498G or 510000M || 1 x NVMe SSD, 3.84TB || 2 x [https://ark.intel.com/content/www/us/en/ark/products/232384/intel-xeon-gold-6448y-processor-60m-cache-2-10-ghz.html Intel Xeon Gold 6448Y] @ 2.10 GHz, 60MB cache L3 || 4 x NVidia H100 SXM5 (80GB)
|}

* To get a larger <code>$SLURM_TMPDIR</code> space, a job can be submitted with <code>--tmp=xG</code>, where <code>x</code> is a value between 370 and 3360.

===CPU nodes===
The 192 cores and the different memory spaces are not equidistant, which causes variable delays (of the order of nanoseconds) to access data. In each node, there are

* 2 sockets, each with 12 system memory channels
** 4 [https://en.wikipedia.org/wiki/Non-uniform_memory_access NUMA] nodes per socket, each connected to 3 system memory channels
*** 3 chiplets per NUMA node, each with its own 32 MiB [https://en.wikipedia.org/wiki/CPU_cache L3 cache memory]
**** 8 cores per chiplet, each with its own 1 MiB L2 cache memory and 32+32 KiB L1 cache memory

In other words, we have
* groups of 8 closely spaced cores sharing a single L3 cache, which is ideal for [[Running_jobs#Threaded_or_OpenMP_job|multithreaded parallel programs]] (for example, with the <code>--cpus-per-task=8</code> option)
* NUMA nodes of 3x8 = 24 cores sharing a trio of system memory channels
* a total of 2x4x3x8 = 192 cores per node

To fully benefit from this topology, full nodes must be reserved (e.g., with <code>--ntasks-per-node=24 --cpus-per-task=8</code>) and the place of processes and threads must be explicitly controlled. Depending on the parallel program and the number of cores used, gains can be marginal or significant.

=== GPU nodes ===
The architecture is not as hierarchical.

* 2 sockets, each with
** 8 system memory channels
** 60 MiB L3 cache memory
** 32 equidistant cores, each each with its own 2 MiB L2 cache memory and 32+48 KiB L1 cache memory
** 2 NVidia H100 accelerators

The 4 node accelerators are interconnected by  [https://en.wikipedia.org/wiki/SXM_(socket) SXM5].

<span id="Instances_GPU"></span>
===GPU instances===

Available GPU instance names are:

{| class="wikitable"
! colspan="2" | Model or instance !! Short name !! Without unit !! By memory !! Long name
|-
| <b>GPU</b>
|| <b>H100-80gb</b>
|| <code>h100</code>
|| <code>h100</code>
|| <code>h100_80gb</code>
|| <code>nvidia_h100_80gb_hbm3</code>
|-
| rowspan="3" | <b>MIG</b>
|| <b>H100-1g.10gb</b>
|| <code>h100_1g.10gb</code>
|| <code>h100_1.10</code>
|| <code>h100_10gb</code>
|| <code>nvidia_h100_80gb_hbm3_1g.10gb</code>
|-
| <b>H100-2g.20gb</b>
|| <code>h100_2g.20gb</code>
|| <code>h100_2.20</code>
|| <code>h100_20gb</code>
|| <code>nvidia_h100_80gb_hbm3_2g.20gb</code>
|-
| <b>H100-3g.40gb</b>
|| <code>h100_3g.40gb</code>
|| <code>h100_3.40</code>
|| <code>h100_40gb</code>
|| <code>nvidia_h100_80gb_hbm3_3g.40gb</code>
|}

To request one or more full H100 GPUs, you need to use one of the following Slurm options:
* <b>One H100-80gb</b> : <code>--gpus=h100:1</code> or <code>--gpus=h100_80gb:1</code>
* <b>Multiple H100-80gb</b> per node :
** <code>--gpus-per-node=h100:2</code>
** <code>--gpus-per-node=h100:3</code>
** <code>--gpus-per-node=h100:4</code>
* <b> For multiple full H100 GPUs</b> spread anywhere: <code>--gpus=h100:n</code> (replace <code>n</code> with the number of GPUs you want)

Approximately half of the GPU nodes are configured with [[Multi-Instance GPU|MIG technology]], and only 3 GPU instance sizes are available:

* <b>H100-1g.10gb</b>: 1/8<sup>th</sup> of the computing power with 10GB GPU memory
* <b>H100-2g.20gb</b>: 2/8<sup>th</sup> of the computing power with 20GB GPU memory
* <b>H100-3g.40gb</b>: 3/8<sup>th</sup> of the computing power with 40GB GPU memory

To request <b>one and only one GPU instance</b> for your compute job, use the corresponding option:

* <b>H100-1g.10gb</b> : <code>--gpus=h100_1g.10gb:1</code>
* <b>H100-2g.20gb</b> : <code>--gpus=h100_2g.20gb:1</code>
* <b>H100-3g.40gb</b> : <code>--gpus=h100_3g.40gb:1</code>

The maximum recommended number of <b>CPU cores and system memory</b> per GPU instance is listed in [[Allocations and compute scheduling#Ratios_in_bundles|this table]].