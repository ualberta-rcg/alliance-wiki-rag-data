<languages />
[[Category:Software]]

[https://www.ansys.com/products/electronics AnsysEDT] regroupe des solutions de simulation électromagnétique telles qu'Ansys HFSS, Ansys Maxwell, Ansys Q3D Extractor, Ansys SIwave et Ansys Icepak, utilisant des flux de travail de CAO électriques (ECAD) et mécaniques (MCAD). AnsysEDT s'intègre également à l'ensemble de la gamme Ansys de solveurs thermiques, fluides et mécaniques, permettant une analyse multiphysique complète.

<span id="Licensing"></span>
= Licence=

AnsysEDT est hébergé sur nos grappes, mais nous n'avons pas une licence qui permet un accès généralisé. Toutefois, plusieurs établissements, facultés et départements possèdent des serveurs de licences qui peuvent être utilisés dépendant de l'aspect légal de leur utilisation. En ce qui a trait à l'aspect technique, nos nœuds de calcul doivent pouvoir communiquer avec votre serveur de licence.  Quand tout sera en place, vous pourrez charger le module ansysEDT qui localisera de lui-même la licence. En cas de difficulté, communiquez avec le [[technical support/fr|soutien technique]].

== Configurer votre propre fichier de licence ==
 Pour indiquer votre licence ansysedt, créez un fichier nommé <code>$HOME/.licenses/ansys.lic</code> qui contient deux lignes. Pour les détails, voir [[Ansys/fr#Configurez_votre_propre_fichier_de_licence|Configurez votre propre fichier de licence]].

<span id="Cluster_batch_job_submission"></span>
= Soumettre des tâches en lots =

Ansys EDT peut être exécuté de manière interactive en mode <i>batch</i> (sans interface graphique) en démarrant d'abord une session salloc avec les options <code>salloc --time=3:00:00 --tasks=8 --mem=16G --account=def- compte</code>; copiez-collez ensuite la commande <code>ansysedt</code> complète donnée à la dernière ligne de <i>script-local-cmd.sh</i> en vous assurant de spécifier manuellement $YOUR_AEDT_FILE.

<span id="Slurm_scripts"></span>
=== Scripts pour l'ordonnanceur Slurm ===

<div class="mw-translate-fuzzy">
Les tâches peuvent être soumises à la file d'attente d'une grappe avec la commande <code>sbatch script-name.sh</code> en utilisant l'un des scripts Slurm pour nœud simple ci-dessous. En date de janvier 2023, ces scripts n'ont été testés que sur Graham et pourraient donc être mis à jour à l'avenir si nécessaire pour fonctionner avec d'autres grappes. Avant de les utiliser, spécifiez le temps de simulation, la mémoire, le nombre de cœurs et remplacez YOUR_AEDT_FILE par le nom de votre fichier d'entrée. Une liste complète des options de ligne de commande peut être obtenue en démarrant AnsysEDT [[Ansys/fr#Mode_graphique|en mode graphique]] avec les commandes <code>ansysedt -help</code> ou <code>ansysedt -Batchoptionhelp</code> pour obtenir des fenêtres graphiques contextuelles déroulantes.
</div>  

<tabs>
<tab name="Nœud simple (ligne de commande)">
{{File
|name=script-local-cmd.sh
|lang="bash"
|contents=
#!/bin/bash

<div class="mw-translate-fuzzy">
#SBATCH --account=account      # Specify your account (def or rrg)
#SBATCH --time=00-01:00        # Specify time (DD-HH:MM)
#SBATCH --mem=16G              # Specify memory (set to 0 to use all compute node memory)
#SBATCH --ntasks=8             # Specify cores (beluga 40, cedar 32 or 48, graham 32 or 44, narval 64)
#SBATCH --nodes=1              # Request one node (Do Not Change)
</div>

<div class="mw-translate-fuzzy">
module load StdEnv/2023
module load ansysedt/2023R2    # ou plus récente
</div>

<div class="mw-translate-fuzzy">
# Uncomment next line to run a test example:
cp -f $EBROOTANSYSEDT/AnsysEM21.2/Linux64/Examples/HFSS/Antennas/TransientGeoRadar.aedt .
</div>

# Specify input file such as:
YOUR_AEDT_FILE="TransientGeoRadar.aedt"

# Remove previous output:
rm -rf $YOUR_AEDT_FILE.* ${YOUR_AEDT_FILE}results

# ---- do not change anything below this line ---- #

echo -e "\nANSYSLI_SERVERS= $ANSYSLI_SERVERS"
echo "ANSYSLMD_LICENSE_FILE= $ANSYSLMD_LICENSE_FILE"
echo -e "SLURM_TMPDIR= $SLURM_TMPDIR on $SLURMD_NODENAME\n"

export KMP_AFFINITY=disabled
ansysedt -monitor -UseElectronicsPPE -ng -distributed -machinelist list=localhost:1:$SLURM_NTASKS \
-batchoptions "TempDirectory=$SLURM_TMPDIR HPCLicenseType=pool HFSS/EnableGPU=0" -batchsolve "$YOUR_AEDT_FILE"
}}
</tab>
<tab name="Nœud simple (options)">
{{File
|name=script-local-opt.sh
|lang="bash"
|contents=
#!/bin/bash

<div class="mw-translate-fuzzy">
#SBATCH --account=account      # Specify your account (def or rrg)
#SBATCH --time=00-01:00        # Specify time (DD-HH:MM)
#SBATCH --mem=16G              # Specify memory (set to 0 to allocate all compute node memory)
#SBATCH --ntasks=8             # Specify cores (beluga 40, cedar 32 or 48, graham 32 or 44, narval 64)
#SBATCH --nodes=1              # Request one node (Do Not Change)
</div>

<div class="mw-translate-fuzzy">
module load StdEnv/2023
module load ansysedt/2023R2    # ou plus récente
</div>

<div class="mw-translate-fuzzy">
# Uncomment next line to run a test example:
cp -f $EBROOTANSYSEDT/AnsysEM21.2/Linux64/Examples/HFSS/Antennas/TransientGeoRadar.aedt .
</div>

# Specify input filename such as:
YOUR_AEDT_FILE="TransientGeoRadar.aedt"

# Remove previous output:
rm -rf $YOUR_AEDT_FILE.* ${YOUR_AEDT_FILE}results

# Specify options filename:
OPTIONS_TXT="Options.txt"

# Write sample options file
rm -f $OPTIONS_TXT
cat > $OPTIONS_TXT <<EOF
\$begin 'Config'
'TempDirectory'='$SLURM_TMPDIR'
'HPCLicenseType'='pool'
'HFSS/EnableGPU'=0
\$end 'Config'
EOF

# ---- do not change anything below this line ---- #

echo -e "\nANSYSLI_SERVERS= $ANSYSLI_SERVERS"
echo "ANSYSLMD_LICENSE_FILE= $ANSYSLMD_LICENSE_FILE"
echo -e "SLURM_TMPDIR= $SLURM_TMPDIR on $SLURMD_NODENAME\n"

export KMP_AFFINITY=disabled

ansysedt -monitor -UseElectronicsPPE -ng -distributed -machinelist list=localhost:1:$SLURM_NTASKS \
-batchoptions $OPTIONS_TXT -batchsolve "$YOUR_AEDT_FILE"
}}
</tab>
</tabs>

<span id="Graphical_use"></span>
= Mode graphique =

<div class="mw-translate-fuzzy">
Les programmes Ansys fonctionnent interactivement en mode graphique sur les nœuds de calcul des grappes ou sur les nœuds VDI de Graham.
</div>

<span id="OnDemand"></span>
<div class="mw-translate-fuzzy">
== Nœuds VDI ==
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
1. Connect to an OnDemand system using one of the following URLs in your laptop browser :<br>
 [https://docs.alliancecan.ca/wiki/Nibi#Access_through_Open_OnDemand_(OOD) NIBI]: <code>https://ondemand.sharcnet.ca</code>
 FIR: <code>https://jupyterhub.fir.alliancecan.ca</code>
 NARVAL: <code> https://portail.narval.calculquebec.ca/</code>
 RORQUAL: <code>https://jupyterhub.rorqual.alliancecan.ca</code>
 TRILLIUM: <code>https://ondemand.scinet.utoronto.ca</code>
2. Open a new terminal window in your desktop and run:
::: <code>module load StdEnv/2023</code>  (default)
::: <code>module load ansysedt/2024R2.1</code> **OR** <code>ansysedt/2023R2</code>
::: Type <code>ansysedt</code> in the terminal and wait for the gui to start
3. Verify the following settings 
::: The following only needs to be done once:
:::: click <code>Tools -> Options -> HPC and Analysis Options -> Edit</code>
:::: When the Analysis Configuration panel appears untic <code>Use Automatic Settings</code>
:::: Ensure the settings in the <code>Machine</code> tab correspond requested desktop resources such as:
:::: <code> | Tasks 1 | Cores 4 | Allocated_Cores | GPUs 0 | RAM 90 | tic Enabled |</code>
:::: Click the OK button to save any changes and close the <code>Analysis Configuration</code> panel
:::: Click the OK button close the <code>HPC and Analysis</code> Options panel
4.  To retrieve the 2024R2.1 Antennas examples, copy its directory under your account as follows:
:::: <code>module load ansysedt/2024R2.1</code>
:::: <code>mkdir -p ~/Ansoft/$EBVERSIONANSYSEDT; rm -rf ~/Ansoft/$EBVERSIONANSYSEDT/Antennas</code>
:::: <code>cp -a $EBROOTANSYSEDT/v242/Linux64/Examples/HFSS/Antennas ~/Ansoft/$EBVERSIONANSYSEDT</code>
5. Now to run the example:
:::: Open one of the Antennas examples .aedt files then click <code>HFSS -> Validation Check</code>
:::: Click simulation -> setup -> advanced -> Mesh/Solution options -> Use Defaults
:::: Start simulation running by clicking <code>Simulation -> Analyze All</code>
:::: To quit without saving the converged solution click <code>File -> Close -> No </code>
6. If ansysedt crashes and won't restart try running the following commands:
:::: <code>pkill -9 -u $USER -f "ansys*|mono|mwrpcss|apip-standalone-service"</code>
:::: <code>rm -rf ~/.mw</code> (ansysedt will re-run first-time configuration on startup)
</div>

<span id="Site-Specific"></span>
= Particularités selon le site =

<span id="SHARCNET_license"></span>
== Licence SHARCNET ==

Les conditions d'utilisation de la licence ANSYS de SHARCNET (qui inclut AnsysEDT) se trouvent sur la [[Ansys/fr|page wiki pour Ansys]], ainsi que les autres informations; elles ne sont pas répétées ici. 

<span id="License_file"></span>
==== Fichier de licence ====

La licence Ansys de SHARCNET peut être utilisée sans frais avec les modules AnsysEDT pour les traaux de recherche sur nos grappes. Pour ce faire, configurez votre fichier <code>ansys.lic</code> comme suit&nbsp;:
<source lang="bash">
[username@cluster:~] cat ~/.licenses/ansys.lic
setenv("ANSYSLMD_LICENSE_FILE", "1055@license3.sharcnet.ca")
setenv("ANSYSLI_SERVERS", "2325@license3.sharcnet.ca")
</source>