<languages />
[[Category:Software]]

[https://www.ansys.com/products/electronics AnsysEDT] regroupe des solutions de simulation électromagnétique telles qu'Ansys HFSS, Ansys Maxwell, Ansys Q3D Extractor, Ansys SIwave et Ansys Icepak, utilisant des flux de travail de CAO électriques (ECAD) et mécaniques (MCAD). AnsysEDT s'intègre également à l'ensemble de la gamme Ansys de solveurs thermiques, fluides et mécaniques, permettant une analyse multiphysique complète.

<span id="Licensing"></span>
= Licence=

AnsysEDT est hébergé sur nos grappes, mais nous n'avons pas une licence qui permet un accès généralisé. Toutefois, plusieurs établissements, facultés et départements possèdent des serveurs de licences qui peuvent être utilisés dépendant de l'aspect légal de leur utilisation. En ce qui a trait à l'aspect technique, nos nœuds de calcul doivent pouvoir communiquer avec votre serveur de licence.  Quand tout sera en place, vous pourrez charger le module ansysEDT qui localisera de lui-même la licence. En cas de difficulté, communiquez avec le [[technical support/fr|soutien technique]].

== Configurer votre propre fichier de licence ==
 Pour indiquer votre licence ansysedt, créez un fichier nommé <code>$HOME/.licenses/ansys.lic</code> qui contient deux lignes. Pour les détails, voir [[Ansys/fr#Configurez_votre_propre_fichier_de_licence|Configurez votre propre fichier de licence]].

<span id="Cluster_batch_job_submission"></span>
= Soumettre des tâches en lots =

Ansys EDT peut être exécuté de manière interactive en mode <i>batch</i> (sans interface graphique) en démarrant d'abord une session salloc avec les options <code>salloc --time=3:00:00 --tasks=8 --mem=16G --account=def- compte</code>; copiez-collez ensuite la commande <code>ansysedt</code> complète donnée à la dernière ligne de <i>script-local-cmd.sh</i> en vous assurant de spécifier manuellement $YOUR_AEDT_FILE.

<span id="Slurm_scripts"></span>
=== Scripts pour l'ordonnanceur Slurm ===

<div class="mw-translate-fuzzy">
Les tâches peuvent être soumises à la file d'attente d'une grappe avec la commande <code>sbatch script-name.sh</code> en utilisant l'un des scripts Slurm pour nœud simple ci-dessous. En date de janvier 2023, ces scripts n'ont été testés que sur Graham et pourraient donc être mis à jour à l'avenir si nécessaire pour fonctionner avec d'autres grappes. Avant de les utiliser, spécifiez le temps de simulation, la mémoire, le nombre de cœurs et remplacez YOUR_AEDT_FILE par le nom de votre fichier d'entrée. Une liste complète des options de ligne de commande peut être obtenue en démarrant AnsysEDT [[Ansys/fr#Mode_graphique|en mode graphique]] avec les commandes <code>ansysedt -help</code> ou <code>ansysedt -Batchoptionhelp</code> pour obtenir des fenêtres graphiques contextuelles déroulantes.
</div>  

<tabs>
<tab name="Nœud simple (ligne de commande)">
{{File
|name=script-local-cmd.sh
|lang="bash"
|contents=
#!/bin/bash

<div class="mw-translate-fuzzy">
#SBATCH --account=account      # Specify your account (def or rrg)
#SBATCH --time=00-01:00        # Specify time (DD-HH:MM)
#SBATCH --mem=16G              # Specify memory (set to 0 to use all compute node memory)
#SBATCH --ntasks=8             # Specify cores (beluga 40, cedar 32 or 48, graham 32 or 44, narval 64)
#SBATCH --nodes=1              # Request one node (Do Not Change)
</div>

<div class="mw-translate-fuzzy">
module load StdEnv/2023
module load ansysedt/2023R2    # ou plus récente
</div>

<div class="mw-translate-fuzzy">
# Uncomment next line to run a test example:
cp -f $EBROOTANSYSEDT/AnsysEM21.2/Linux64/Examples/HFSS/Antennas/TransientGeoRadar.aedt .
</div>

# Specify input file such as:
YOUR_AEDT_FILE="TransientGeoRadar.aedt"

# Remove previous output:
rm -rf $YOUR_AEDT_FILE.* ${YOUR_AEDT_FILE}results

# ---- do not change anything below this line ---- #

echo -e "\nANSYSLI_SERVERS= $ANSYSLI_SERVERS"
echo "ANSYSLMD_LICENSE_FILE= $ANSYSLMD_LICENSE_FILE"
echo -e "SLURM_TMPDIR= $SLURM_TMPDIR on $SLURMD_NODENAME\n"

export KMP_AFFINITY=disabled
ansysedt -monitor -UseElectronicsPPE -ng -distributed -machinelist list=localhost:1:$SLURM_NTASKS \
-batchoptions "TempDirectory=$SLURM_TMPDIR HPCLicenseType=pool HFSS/EnableGPU=0" -batchsolve "$YOUR_AEDT_FILE"
}}
</tab>
<tab name="Nœud simple (options)">
{{File
|name=script-local-opt.sh
|lang="bash"
|contents=
#!/bin/bash

<div class="mw-translate-fuzzy">
#SBATCH --account=account      # Specify your account (def or rrg)
#SBATCH --time=00-01:00        # Specify time (DD-HH:MM)
#SBATCH --mem=16G              # Specify memory (set to 0 to allocate all compute node memory)
#SBATCH --ntasks=8             # Specify cores (beluga 40, cedar 32 or 48, graham 32 or 44, narval 64)
#SBATCH --nodes=1              # Request one node (Do Not Change)
</div>

<div class="mw-translate-fuzzy">
module load StdEnv/2023
module load ansysedt/2023R2    # ou plus récente
</div>

<div class="mw-translate-fuzzy">
# Uncomment next line to run a test example:
cp -f $EBROOTANSYSEDT/AnsysEM21.2/Linux64/Examples/HFSS/Antennas/TransientGeoRadar.aedt .
</div>

# Specify input filename such as:
YOUR_AEDT_FILE="TransientGeoRadar.aedt"

# Remove previous output:
rm -rf $YOUR_AEDT_FILE.* ${YOUR_AEDT_FILE}results

# Specify options filename:
OPTIONS_TXT="Options.txt"

# Write sample options file
rm -f $OPTIONS_TXT
cat > $OPTIONS_TXT <<EOF
\$begin 'Config'
'TempDirectory'='$SLURM_TMPDIR'
'HPCLicenseType'='pool'
'HFSS/EnableGPU'=0
\$end 'Config'
EOF

# ---- do not change anything below this line ---- #

echo -e "\nANSYSLI_SERVERS= $ANSYSLI_SERVERS"
echo "ANSYSLMD_LICENSE_FILE= $ANSYSLMD_LICENSE_FILE"
echo -e "SLURM_TMPDIR= $SLURM_TMPDIR on $SLURMD_NODENAME\n"

export KMP_AFFINITY=disabled

ansysedt -monitor -UseElectronicsPPE -ng -distributed -machinelist list=localhost:1:$SLURM_NTASKS \
-batchoptions $OPTIONS_TXT -batchsolve "$YOUR_AEDT_FILE"
}}
</tab>
</tabs>

<span id="Graphical_use"></span>
= Mode graphique =

<div class="mw-translate-fuzzy">
Les programmes Ansys fonctionnent interactivement en mode graphique sur les nœuds de calcul des grappes ou sur les nœuds VDI de Graham.
</div>

<span id="Compute_nodes"></span>
== Nœuds de calcul == 

Ansys peut être exécuté interactivement sur un nœud de calcul simple pour une durée pouvant aller jusqu'à 24 heures. C'est l'approche idéale pour tester des simulations intensives puisque tous les cœurs et la mémoire peuvent être demandés avec salloc comme décrit dans [[VNC/fr#Nœuds _de_calcul|TigerVNC]]. Une fois la connexion faite avec vncviewer, toutes les versions suivantes peuvent être lancées après que les modules requis ont été chargés.

<div class="mw-translate-fuzzy">
::: Lancez une session interactive avec la commande salloc (pour indiquer les cœurs et la mémoire).
::: <code>salloc --time=3:00:00 --nodes=1 --cores=8 --mem=16G --account=def-group</code>
::: <code>xfwm4 --replace &</code> (appuyez 2 fois sur enter)
::: <code>module load StdEnv/2020 ansysedt/2021R2</code>, ou
::: <code>module load StdEnv/2020 ansysedt/2023R2</code>, ou
::: <code>module load StdEnv/2023 ansysedt/2023R2</code>, ou
::: <code>module load StdEnv/2023 ansysedt/2024R2</code>  <--- !!! version de ce module uniquement sur Graham !!!
::: <code>ansysedt</code>
::: o Cliquez sur <code>Tools -> Options -> HPC and Analysis Options -> Edit</code> ensuite
:::: 1) supprimez la coche pour Use Automatic Settings (une fois seulement)
:::: 2) sous l'onglet Machines, ne modifiez pas Cores (détecté par Slurm)
::: o Pour lancer une analyse interactive, cliquez sur <code>Project -> Analyze All</code>
</div>

<span id="OnDemand"></span>
<div class="mw-translate-fuzzy">
== Nœuds VDI ==
</div>

<div class="mw-translate-fuzzy">
Les programmes Ansys peuvent être exécutés jusqu'à 7 jours sur les nœuds Graham VDI (gra-vdi.alliancecan.ca) en utilisant un maximum de 8 cœurs (maximum de 16 cœurs) et 128GB de mémoire. Le système VDI fournit une accélération GPU OpenGL, ce qui est idéal pour les graphiques à haute performance. On peut utiliser VDI pour créer ou modifier des fichiers d'entrée de simulation, post-traiter des données ou visualiser des résultats de simulation. Connectez-vous d'abord avec [[VNC/fr#Nœuds_VDI|TigerVNC]] puis ouvrez une nouvelle fenêtre de terminal et démarrez l'une des versions de programme prises en charge montrées ci-dessous. La barre verticale | est utilisée pour séparer les commandes. La taille maximale d'une tâche parallèle exécutée sur gra-vdi doit être limitée à 16 cœurs pour éviter de surcharger les serveurs et de nuire aux autres utilisateurs. Pour exécuter deux tâches simultanées (16 cœurs maximum chacune), utilisez deux sessions VCN distinctes. Pour la première session, connectez-vous avec VNC à gra-vdi3.sharcnet.ca. Pour la deuxième session, connectez-vous à gra-vdi4.sharecnet.ca aussi avec VNC. Dans chacune des sessions, démarrez Ansys en mode graphique et faites exécuter la simulation. Notez que les simulations simultanées doivent en général être exécutées dans des répertoires différents pour éviter les conflits de fichiers. Contrairement aux connexions VNC des nœuds de calcul (qui imposent des limites Slurm via salloc), il n'y a pas de contrainte de limite de temps sur gra-vdi à l'exécution des simulations.
</div>

<div lang="en" dir="ltr" class="mw-content-ltr">
1. Connect to an OnDemand system using one of the following URLs in your laptop browser :<br>
 [https://docs.alliancecan.ca/wiki/Nibi#Access_through_Open_OnDemand_(OOD) NIBI]: <code>https://ondemand.sharcnet.ca</code>
 FIR: <code>https://jupyterhub.fir.alliancecan.ca</code>
 RORQUAL: <code>https://jupyterhub.rorqual.alliancecan.ca</code>
 TRILLIUM: <code>https://ondemand.scinet.utoronto.ca</code>
2. Open a new terminal window in your desktop and run:
::: <code>module load StdEnv/2023</code>  (default)
::: <code>module load ansysedt/2024R2.1</code> **OR** <code>ansysedt/2023R2</code>
::: Type <code>ansysedt</code> in the terminal and wait for the gui to start
::: The following only needs to be done once:
:::: click <code>Tools -> Options -> HPC and Analysis Options -> Options</code>
:::: change <code>HPC License</code> pulldown to <b>Pool</b> (allows > 4 cores to be used)
:::: click <code>OK</code>
3.  To run the 2024R2.1 Antennas example copy the corresponding version into your account:
:::: <code>module load ansysedt/2024R2.1</code>
:::: <code>mkdir -p ~/Ansoft/$EBVERSIONANSYSEDT; cd ~/Ansoft/$EBVERSIONANSYSEDT; rm -rf Antennas</code>
:::: <code>cp -a $EBROOTANSYSEDT/v242/Linux64/Examples/HFSS/Antennas ~/Ansoft/$EBVERSIONANSYSEDT</code>
4. Now to run the example:
:::: open a simulation .aedt file then click <code>HFSS -> Validation Check</code>
:::: (if errors are reported by the validation check, close then reopen the simulation and repeat as required)
::::  to run simulation click <code>Project -> Analyze All</code>
:::: to quit without saving the converged solution click <code>File -> Close -> No </code>
::: If the program crashes and won't restart try running the following commands:
:::: <code>pkill -9 -u $USER -f "ansys*|mono|mwrpcss|apip-standalone-service"</code>
:::: <code>rm -rf ~/.mw</code> (ansysedt will re-run first-time configuration on startup)
</div>

<span id="Site-Specific"></span>
= Particularités selon le site =

<span id="SHARCNET_license"></span>
== Licence SHARCNET ==

Les conditions d'utilisation de la licence ANSYS de SHARCNET (qui inclut AnsysEDT) se trouvent sur la [[Ansys/fr|page wiki pour Ansys]], ainsi que les autres informations; elles ne sont pas répétées ici. 

<span id="License_file"></span>
==== Fichier de licence ====

La licence Ansys de SHARCNET peut être utilisée sans frais avec les modules AnsysEDT pour les traaux de recherche sur nos grappes. Pour ce faire, configurez votre fichier <code>ansys.lic</code> comme suit&nbsp;:
<source lang="bash">
[username@cluster:~] cat ~/.licenses/ansys.lic
setenv("ANSYSLMD_LICENSE_FILE", "1055@license3.sharcnet.ca")
setenv("ANSYSLI_SERVERS", "2325@license3.sharcnet.ca")
</source>