<languages />

<translate>
<!--T:1-->
{| class="wikitable"
|-
| Availability date: <i>August 11, 2025</i>
|-
| Login node: <i>fir.alliancecan.ca</i>
|-
| Automation node: <i>robot.fir.alliancecan.ca</i>
|-
| Globus collection: [https://globus.alliancecan.ca/file-manager?origin_id=8dec4129-9ab4-451d-a45f-5b4b8471f7a3&two_pane=false <i>alliancecan#fir-globus</i>]
|-
| JupyterHub: [https://jupyterhub.fir.alliancecan.ca/ jupyterhub.fir.alliancecan.ca]
|-
| Data transfer node (rsync, scp, sftp ...): <i>to be determined</i>
|-
| Portal: <i>to be determined</i>
|}

<!--T:4-->
Fir is a versatile, heterogeneous computing cluster built in partnership with Lenovo Canada and Data Direct Networks (DDN) and is designed to support a wide range of scientific computations. It is hosted at Simon Fraser University (SFU) in Burnaby, British Columbia, and is named after the Red Creek Fir—the largest known Douglas fir tree on Earth by volume.

=About Fir= <!--T:52-->

<!--T:5-->
SFU remains committed to environmentally sustainable high-performance computing. With Fir, the university is transitioning from traditional air cooling to advanced direct-to-chip liquid cooling, significantly improving energy efficiency and reducing power consumption associated with cooling.

<!--T:6-->
The new high-speed InfiniBand network in Fir delivers more than twice the performance of the previous-generation Cedar cluster.

<!--T:7-->
Fir is ranked #78 on the June 2025 [https://top500.org/lists/top500/list/2025/06/ TOP500 list] of the world’s most powerful supercomputers.

=Access= <!--T:53-->

<!--T:9-->
Each researcher must request access in CCDB, via Resources--> Access Systems.

<!--T:10-->
Select Fir from the list on the left.

<!--T:11-->
Select I request access.

<!--T:12-->
It can take up to one hour for your access to be enabled.

=Site-specific policies= <!--T:54-->

<!--T:2-->
Fir's compute nodes have full access to the internet.

<!--T:13-->
The crontab tool is not supported.

<!--T:14-->
Each job should have a duration of at least one hour (at least five minutes for test jobs) and the maximum job duration is 7 days (168 hours). 

<!--T:15-->
For transferring data via Globus, use the endpoint specified at the top of this page; for tools like rsync and scp, please use the login node.

=Storage= <!--T:55-->

<!--T:16-->
51PB high-performance DDN Lustre storage (2PB NVME / 49 SAS).
{{Note|All mounts share the available storage|}}
{| class="wikitable"
! Storage Area !!  Access Path !! Quotas !! Backup !! Notes
|-
| '''HOME''' || Default <code>$HOME</code> || Small per-user quota || Daily automatic backup || Cannot be increased; use `/project</code> for larger storage
|-
| '''SCRATCH''' || <code>$HOME/scratch</code> || Large per-user quota || No backup || For temporary files; old files are purged automatically
|-
| '''PROJECT''' || <code>$HOME/project/${def-project-id}</code> || Large and adjustable per-project quota || Daily backup || For group data sharing and large datasets
|}

=High-performance interconnect= <!--T:56-->

<!--T:17-->
* InfiniBand NDR interconnect
* CPU node island size, is 27:5 blocking factor over 216 nodes of 192 cores
* GPU nodes are 2:1 blocking factor
* Storage access is fully non-blocking

=Node characteristics= <!--T:57-->

<!--T:18-->
{| class="wikitable sortable"
! nodes !! cores !! available memory !! CPU !! Storage !! GPU
|-
| 864 || rowspan="2"| 192 || 750G or 768000M || 2 x AMD EPYC 9655 (Zen 5) @ 2.7 GHz, 384MB cache L3 || 7.84TB NVMe 
|-
| 8 || 6000G or 6144000M || 2 x AMD EPYC 9654 (Zen 4) @ 2.4 GHz, 384MB cache L3 || 7.84TB NVMe 
|- 
|  160 || 48 || 1125G or 1152000M || 1 x AMD EPYC 9454 (Zen 4) @ 2.75 GHz, 256MB cache L3 || 7.84TB NVMe || 4 x NVidia H100 SXM5 (80 GB memory)
|}

==CPU nodes== <!--T:58-->

<!--T:19-->
===Architecture===
Each node features 2 × AMD EPYC 9655 (Zen 5) @ 2.7 GHz processors, totaling 192 physical cores. The system is built on a chiplet-based NUMA architecture, where each chiplet (CCD) operates as a separate NUMA node. The memory and cache hierarchy is non-uniform, and performance is sensitive to data locality.
[[File:Fircpulayout.png|thumb|900x900px|Layout of Fir CPU nodes, as reported by the <code>Istopo</code> command]]

===Layout=== <!--T:59-->

<!--T:20-->
* 2 sockets, each with:
** 96 cores
** 4 NUMA nodes, each with:
*** 3 CCDs (chiplets), each with:
**** 8 cores
**** 32 MiB shared L3 cache
*** 3 memory channels

<!--T:21-->
Each core with:
* 1 MiB L2 cache
* 32+32 KiB L1 instruction/data cache
* 12 DDR5 memory channels (shared via the I/O die)

<!--T:22-->
Total:
* 8 NUMA nodes per node (4 per socket × 2)
* 24 CCDs (chiplets) per node (12 per socket  × 2)
* 192 cores total
* 768 MiB L3 cache total

===Performance tuning recommendations=== <!--T:60-->

<!--T:23-->
To make best use of the EPYC 9655's architecture:

<!--T:24-->
1. Align tasks to CCDs 
Each CCD contains 8 tightly-coupled cores with shared L3 cache. Keeping threads within a CCD avoids inter-chiplet communication latency.

<!--T:25-->
Use:<code>#SBATCH --cpus-per-task=8</code>

<!--T:26-->
This ensures that threads of each task stay within a single CCD.

<!--T:27-->
2. Distribute tasks across CCDs

<!--T:28-->
With 24 CCDs per node, launch 24 tasks per node to fully utilize all CCDs without overloading any single one.

<!--T:29-->
Use:<code>#SBATCH --ntasks-per-node=24</code>

<!--T:30-->
Together with <code>--cpus-per-task=8</code>, this fills the full 192-core node cleanly.

==GPU nodes== <!--T:61-->

<!--T:31-->
===Architecture===
Each GPU node contains 1 × AMD EPYC 9454 (Zen 4) @ 2.75 GHz processor with 48 physical cores. This processor uses AMD’s chiplet-based NUMA architecture, with memory access times that vary depending on core and memory locality. GPU nodes use the NPS=4 mode (NUMA Per Socket), dividing the socket into four NUMA nodes for better memory locality.

<!--T:62-->
===Layout===
[[File:Firgpulayout.png.png|thumb|900x900px|Layout of Fir GPU nodes, as reported by the "lstopo" command]]

<!--T:32-->
* 1 socket, configured as NPS=4:
** 4 NUMA nodes, each with
*** 2 CCDs (Core Complex Dies), each with
**** 6 cores
**** 32 MiB of shared L3 cache
*** 3 memory channels

<!--T:34-->
Each core has:
* 1 MiB L2 cache
* 32 KiB L1 instruction cache
* 32 KiB L1 data cache
* 12 DDR5 memory channels (shared via the I/O die)

<!--T:36-->
* 2 NVidia H100 80GB accelerators
** The 4 node accelerators are interconnected by SXM5.

===Performance tuning recommendations=== <!--T:63-->

<!--T:38-->
To fully utilize the architecture of the EPYC 9454 CPU and ensure optimal CPU-GPU data locality:

<!--T:39-->
1. Bind threads to CCDs

<!--T:40-->
Each CCD has 6 closely coupled cores sharing a 32 MiB L3 cache. To keep threads within a CCD: <code>#SBATCH --cpus-per-task=6</code>

<!--T:41-->
This confines threads to one CCD, reducing cross-CCD latency and improving cache usage.

<!--T:42-->
2. Match Tasks to NUMA Nodes
With 4 NUMA nodes per socket (NPS=4), launch 4 tasks per node (or a multiple thereof) for best performance:
<syntaxhighlight lang="bash">
#SBATCH --ntasks-per-node=4
#SBATCH --cpus-per-task=12
</syntaxhighlight>

<!--T:43-->
This keeps each task within a NUMA domain and ensures local access to memory and the GPU.

===GPU instances=== <!--T:64-->

<!--T:44-->
To request one or more full H100 GPUs, you need to use one of the following Slurm options:

<!--T:45-->
'''One H100-80gb''' : <code>--gpus=h100:1</code>

<!--T:46-->
'''Multiple H100-80gb per node''' :
* <code>--gpus-per-node=h100:2</code>
* <code>--gpus-per-node=h100:3</code>
* <code>--gpus-per-node=h100:4</code>

<!--T:47-->
'''For multiple full H100 GPUs spread anywhere''': <code>--gpus=h100:n</code> (replace n with the number of GPUs you want)

<!--T:48-->
Approximately half of the GPU nodes are configured with MIG technology, and only 3 GPU instance sizes are available:

<!--T:49-->
* '''1g.10gb''': 1/8th of the computing power with 10GB GPU memory
* '''2g.20gb''': 2/8th of the computing power with 20GB GPU memory
* '''3g.40gb''': 3/8th of the computing power with 40GB GPU memory

<!--T:50-->
To request one and only one GPU instance for your compute job, use the corresponding option:

<!--T:51-->
* '''1g.10gb''' : <code>--gpus=nvidia_h100_80gb_hbm3_1g.10gb:1</code>
* '''2g.20gb''' : <code>--gpus=nvidia_h100_80gb_hbm3_2g.20gb:1</code>
* '''3g.40gb''' : <code>--gpus=nvidia_h100_80gb_hbm3_3g.40gb:1</code>
</translate>